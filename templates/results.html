{% extends "base.html" %}

{% block title %}Player Results{% endblock %}

{% block head %}
<style>
    .gridjs-container {
        margin-bottom: 20px;
    }
    .gridjs-search {
        float: right;
    }
    .flag-icon {
        width: 20px;
        margin-right: 5px;
    }
</style>
{% endblock %}

{% block content %}
<h1 class="mb-4">Итоги сезонов</h1>

<div class="mb-4">
    <div class="btn-group" role="group">
        {% if selected_season %}
            <button id="sball" type="button" class="btn btn-outline-primary">All</button>
        {% else %}
            <button id="sball" class="btn btn-outline-primary active" type="button">All</button>
        {% endif %}
        {% for season in all_seasons %}
            {% if season == selected_season %}
                <button id="sb{{season.id}}" type="button" class="btn btn-outline-primary active">{{ season.year }}/{{ season.name }}</button>
            {% else %}
                <button id="sb{{season.id}}" type="button" class="btn btn-outline-primary">{{ season.year }}/{{ season.name }}</button>
            {% endif %}

        {% endfor %}
    </div>
</div>

<div id="players-table"></div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const results = {{ results|tojson|safe }};

        const formattedPlayers = results.map(player => {
            return {
                rank: player.id,  // Will be updated to actual rank after sorting
                name: `${player.first_name} ${player.last_name}`,
                position: `${player.position}`,
                match_count: `${player.match_count}`,
                win_count: `${player.win_count}`,
                relegation: `${player.relegation}`,
                season: `${player.season}`,
                division: `${player.division}`,
            };

        });

        new gridjs.Grid({
            columns: [
                { id: 'season', name: 'Season', width: '100px' },
                { id: 'division', name: 'Division', width: '80px' },
                {
                    id: 'name',
                    name: 'Player',
                    formatter: (cell) => gridjs.html(`<a href="/player/${results.find(p => `${p.first_name} ${p.last_name}` === cell).id}">${cell}</a>`)
                },
                { id: 'position', name: 'Position', width: '80px' },
                { id: 'match_count', name: 'Matches', width: '80px' },
                { id: 'win_count', name: 'Wins', width: '80px' },
                { id: 'relegation', name: 'Relegation', width: '100px' },
            ],
            data: formattedPlayers,
            search: true,
            sort: true,
            pagination: {
                limit: 15
            },
            style: {
                table: {
                    'white-space': 'nowrap'
                }
            }
        }).render(document.getElementById('players-table'));
    });
</script>
{% endblock %}