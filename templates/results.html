{% extends "base.html" %}

{% block title %}Player Ratings - Tennis Ratings{% endblock %}

{% block head %}
<style>
    .gridjs-container {
        margin-bottom: 20px;
    }
    .gridjs-search {
        float: right;
    }
    .flag-icon {
        width: 20px;
        margin-right: 5px;
    }
</style>
{% endblock %}

{% block content %}
<h1 class="mb-4">Player Ratings</h1>

<div class="mb-4">
    <div class="btn-group" role="group">
        <button type="button" class="btn btn-outline-primary active">ATP</button>
        <button type="button" class="btn btn-outline-primary">WTA</button>
    </div>
</div>

<div id="players-table"></div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const results = {{ results|tojson|safe }};

        const formattedPlayers = results.map(player => {
            return {
                rank: player.id,  // Will be updated to actual rank after sorting
                name: `${player.first_name} ${player.last_name}`,
                position: `${player.position}`,
                match_count: `${player.match_count}`,
                win_count: `${player.win_count}`,
                relegation: `${player.relegation}`,
            };

        });

        // Add rank based on sorted position
        formattedPlayers.forEach((player, index) => {
            player.rank = index + 1;
        });

        new gridjs.Grid({
            columns: [
                { id: 'rank', name: 'Rank', width: '80px' },
                {
                    id: 'name',
                    name: 'Player',
                    formatter: (cell) => gridjs.html(`<a href="/player/${results.find(p => `${p.first_name} ${p.last_name}` === cell).id}">${cell}</a>`)
                },
                { id: 'position', name: 'Position', width: '80px' },
                { id: 'match_count', name: 'Matches', width: '80px' },
                { id: 'win_count', name: 'Wins', width: '80px' },
                { id: 'relegation', name: 'Relegation', width: '100px' },
            ],
            data: formattedPlayers,
            search: true,
            sort: true,
            pagination: {
                limit: 10
            },
            style: {
                table: {
                    'white-space': 'nowrap'
                }
            }
        }).render(document.getElementById('players-table'));
    });
</script>
{% endblock %}